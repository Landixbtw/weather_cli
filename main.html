<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>/home/ole/Dokumente/cs50/Final_Project/weather_cli/src/main.c</title>
<meta name="colorscheme" content="darcula"></meta>
<style>
* {font-family: monospace}
body {background-color: #2b2b2b; color: #a9b7c6}
.String {color: #6a8759}
.NonText {color: #606060}
.Operator {color: #e0e2ea}
.Keyword {color: #cc7832}
.Number {color: #6897bb}
.Constant {color: #9876aa; font-style: italic}
.-_parent {}
.PreProc {color: #bbb529}
.Comment {color: #808080}
.-spell {}
.-variable {color: #e0e2ea}
.Delimiter {color: #cc7832}
.Function {color: #ffc66d}
.NormalFg {color: #a9b7c6}
</style>
</head>
<body style="display: flex">
<pre>
<span class="Keyword">#include</span> <span class="String">&lt;stdio.h&gt;</span> <span class="Comment">  You • Di 03 Sep 2024 17:10:51 CEST • first commit no keys leaked</span>

<span class="Keyword">#include</span> <span class="String">&lt;stdlib.h&gt;</span>
<span class="Keyword">#include</span> <span class="String">&lt;string.h&gt;</span>
<span class="Keyword">#include</span> <span class="String">&lt;locale.h&gt;</span>

<span class="Keyword">#include</span> <span class="String">&lt;curl/curl.h&gt;</span>
<span class="Keyword">#include</span> <span class="String">&lt;curl/easy.h&gt;</span>

<span class="Keyword">#include</span> <span class="String">&quot;../include/cJSON.h&quot;</span>
<span class="Keyword">#include</span> <span class="String">&quot;../include/terminal_support.h&quot;</span>
<span class="Keyword">#include</span> <span class="String">&quot;../include/image_to_ascii.h&quot;</span>
<span class="Keyword">#include</span> <span class="String">&quot;../include/terminal_display_picture.h&quot;</span>

<span class="Keyword">#define</span> <span class="-variable"><span class="Constant"><span class="Constant">MAX_URL_LENGTH</span></span></span> <span class="-variable"><span class="Number">256</span></span>
<span class="Keyword">#define</span> <span class="-variable"><span class="Constant"><span class="Constant">PROGRAM_NAME</span></span></span> <span class="-variable"><span class="String">&quot;./weather_cli&quot;</span></span>


<span class="Keyword">const</span> <span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">api_key_filename</span> <span class="Operator">=</span> <span class="String">&quot;src/resources/WEATHERSTACK_API_KEY.env&quot;</span><span class="Delimiter">;</span>
<span class="Keyword">const</span> <span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">json_filename</span> <span class="Operator">=</span> <span class="String">&quot;src/resources/json_data.json&quot;</span><span class="Delimiter">;</span>

<span class="Comment"><span class="-spell">/*<span class="NonText">·</span>
<span class="NonText">▎</span>* To give the user the weather info he wants we need to get a city name.
*/</span></span>

<span class="PreProc">char</span> <span class="-variable"><span class="Constant">ACCESS_KEY</span></span><span class="Delimiter">[</span><span class="Number">124</span><span class="Delimiter">]</span><span class="Delimiter">;</span>
<span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable"><span class="Constant">BASE_URL</span></span> <span class="Operator">=</span> <span class="String">&quot;http://api.weatherstack.com/current&quot;</span><span class="Delimiter">;</span>
<span class="PreProc">char</span> <span class="-variable">url</span><span class="Delimiter">[</span><span class="-variable"><span class="Constant">MAX_URL_LENGTH</span></span><span class="Delimiter">]</span><span class="Delimiter">;</span>
<span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">units</span> <span class="Operator">=</span> <span class="String">&quot;m&quot;</span><span class="Delimiter">;</span>
<span class="PreProc">long</span> <span class="-variable">http_code</span> <span class="Operator">=</span> <span class="Number">0</span><span class="Delimiter">;</span>


<span class="PreProc">size_t</span> <span class="-variable"><span class="Function">write_data</span></span><span class="Delimiter">(</span><span class="PreProc">void</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">ptr</span></span><span class="Delimiter">,</span> <span class="PreProc">size_t</span> <span class="-variable"><span class="-variable">size</span></span><span class="Delimiter">,</span> <span class="PreProc">size_t</span> <span class="-variable"><span class="-variable">nmemb</span></span><span class="Delimiter">,</span> <span class="PreProc">void</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">stream</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="PreProc">void</span> <span class="-variable"><span class="Function">build_url</span></span><span class="Delimiter">(</span><span class="PreProc">char</span> <span class="-variable"><span class="Operator">*</span><span class="-variable"><span class="Constant">CITY</span></span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="Comment"><span class="-spell">//</span></span>
<span class="PreProc">void</span> <span class="-variable"><span class="Function">replace_umlaute</span></span><span class="Delimiter">(</span><span class="PreProc">char</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">dest</span></span><span class="Delimiter">,</span> <span class="Keyword">wchar_t</span> <span class="-variable"><span class="-variable">umlaut</span></span><span class="Delimiter">,</span> <span class="PreProc">size_t</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">j</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable"><span class="Function">filter_char</span></span><span class="Delimiter">(</span><span class="Keyword">const</span> <span class="Keyword">wchar_t</span> <span class="-variable"><span class="-variable">input</span></span><span class="Delimiter">,</span> <span class="PreProc">size_t</span> <span class="-variable"><span class="-variable">output_size</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="Comment"><span class="-spell">//</span></span>
<span class="PreProc">char</span><span class="Operator">*</span> <span class="-variable"><span class="Function">transliterate_umlaut</span></span><span class="Delimiter">(</span><span class="Keyword">const</span> <span class="PreProc">char</span><span class="-variable"><span class="Operator">*</span> <span class="-variable">input</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>

<span class="PreProc">int</span> <span class="-variable"><span class="Function">main</span></span><span class="Delimiter">(</span><span class="PreProc">int</span> <span class="-variable"><span class="-variable">argc</span></span><span class="Delimiter">,</span> <span class="PreProc">char</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">argv</span><span class="Delimiter">[</span><span class="Delimiter">]</span></span><span class="Delimiter">)</span><span class="NonText">·</span>
<span class="Delimiter">{</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">CURL</span> <span class="Operator">*</span><span class="-variable">curl</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">curl_easy_init</span></span><span class="Delimiter">(</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">CURLcode</span> <span class="-variable">res</span><span class="Delimiter">;</span>
<span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Comment"><span class="-spell">/* to have &quot;access&quot; to the key, we first need to load/read the file into memory */</span></span>
<span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">FILE</span> <span class="Operator">*</span><span class="-variable">read_api_key_file</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">FILE</span> <span class="Operator">*</span><span class="-variable">temp_json_file</span><span class="Delimiter">;</span>
<span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable">read_api_key_file</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">fopen</span></span><span class="Delimiter">(</span><span class="-variable">api_key_filename</span><span class="Delimiter">,</span> <span class="String">&quot;r&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">read_api_key_file</span> <span class="Operator">==</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;Error: Couldn't open file: %s<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-variable">api_key_filename</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">return</span> <span class="Number">1</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Delimiter">}</span>
<span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">fscanf</span></span><span class="Delimiter">(</span><span class="-variable">read_api_key_file</span><span class="Delimiter">,</span> <span class="String">&quot;%s&quot;</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">ACCESS_KEY</span></span><span class="Delimiter">)</span> <span class="Operator">!=</span> <span class="Number">1</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable"><span class="Function">perror</span></span><span class="Delimiter">(</span><span class="String">&quot;ERROR: Failed to read API key from file<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable"><span class="Function">fclose</span></span><span class="Delimiter">(</span><span class="-variable">read_api_key_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">return</span> <span class="Number">1</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Delimiter">}</span>
<span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">if</span> <span class="Delimiter">(</span><span class="Operator">!</span><span class="-variable"><span class="Function">setlocale</span></span><span class="Delimiter">(</span><span class="-variable"><span class="Constant">LC_CTYPE</span></span><span class="Delimiter">,</span> <span class="String">&quot;de_DE.UTF-8&quot;</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable"><span class="Function">perror</span></span><span class="Delimiter">(</span><span class="String">&quot;Can't set the specified locale!<span class="PreProc">\n</span> Check LANG, LC_CTYPE, LC_ALL.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">return</span> <span class="Number">1</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Delimiter">}</span>
<span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">url_string</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Comment"><span class="-spell">/* This gives us the user input */</span></span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="Keyword">if</span><span class="Delimiter">(</span><span class="-variable">argc</span> <span class="Operator">==</span> <span class="Number">2</span><span class="Delimiter">)</span> <span class="Delimiter">{</span><span class="NonText">·</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">transliterated</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable">url_string</span> <span class="Operator">=</span> <span class="-variable">argv</span><span class="Delimiter">[</span><span class="Number">1</span><span class="Delimiter">]</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable">url_string</span><span class="Operator">=</span> <span class="-variable"><span class="Function">transliterate_umlaut</span></span><span class="Delimiter">(</span><span class="-variable">argv</span><span class="Delimiter">[</span><span class="Number">1</span><span class="Delimiter">]</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable"><span class="Function">build_url</span></span><span class="Delimiter">(</span><span class="-variable">url_string</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText">▎</span><span class="NonText"> </span><span class="NonText"> </span><span class="NonText"> </span><span class="-variable"><span class="Function">free</span></span><span class="Delimiter">(</span><span class="-variable">transliterated</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span> <span class="Keyword">else</span> <span class="Delimiter">{</span>
        <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;Usage: %s &lt;city&gt;<span class="PreProc">\n</span>Example: %s New+York<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">PROGRAM_NAME</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">PROGRAM_NAME</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Function">fclose</span></span><span class="Delimiter">(</span><span class="-variable">read_api_key_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">return</span> <span class="Number">1</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span>

    <span class="Comment"><span class="-spell">// FIX: Error handling for cities that dont exist / and or partial city names ? Api just autocompletes to some random city</span></span>

    <span class="Comment"><span class="-spell">/*
     * we first need to make a call to the weatherstack api to get the json data
     *
     * https://curl.se/libcurl/c/libcurl-tutorial.html
    */</span></span>


    <span class="Comment"><span class="-spell">// stackoverflow.com/questions/27422918/send-http-get-request-using-curl-in-c</span></span>
    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">curl</span><span class="Delimiter">)</span>
    <span class="Delimiter">{</span>
        <span class="-variable"><span class="Function">curl_easy_setopt</span></span><span class="Delimiter">(</span><span class="-variable">curl</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">CURLOPT_URL</span></span><span class="Delimiter">,</span> <span class="-variable">url</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Function">curl_easy_setopt</span></span><span class="Delimiter">(</span><span class="-variable">curl</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">CURLOPT_VERBOSE</span></span><span class="Delimiter">,</span> <span class="Number">0L</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Comment"><span class="-spell">/* For write_data to actually write data, we first need to open a file,
         * and after write_data has written data we need to close the file again.<span class="NonText">·</span>
        */</span></span>

        <span class="Comment"><span class="-spell">// wb = write binary</span></span>
        <span class="-variable">temp_json_file</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">fopen</span></span><span class="Delimiter">(</span><span class="-variable">json_filename</span><span class="Delimiter">,</span> <span class="String">&quot;wb+&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">temp_json_file</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>

            <span class="-variable"><span class="Function">curl_easy_setopt</span></span><span class="Delimiter">(</span><span class="-variable">curl</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">CURLOPT_WRITEFUNCTION</span></span><span class="Delimiter">,</span> <span class="-variable">write_data</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
            <span class="-variable"><span class="Function">curl_easy_setopt</span></span><span class="Delimiter">(</span><span class="-variable">curl</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">CURLOPT_WRITEDATA</span></span><span class="Delimiter">,</span> <span class="-variable">temp_json_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

            <span class="Comment"><span class="-spell">/* Perform the request, res gets the return code */</span></span>
            <span class="-variable">res</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">curl_easy_perform</span></span><span class="Delimiter">(</span><span class="-variable">curl</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

            <span class="Comment"><span class="-spell">/* Then we check for errors */</span></span>
            <span class="Keyword">if</span><span class="Delimiter">(</span><span class="-variable">res</span> <span class="Operator">!=</span> <span class="-variable"><span class="Constant">CURLE_OK</span></span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
                <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span><span class="String">&quot;<span class="PreProc">\n</span>curl_easy_perform() failed: %s<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span><span class="-variable"><span class="Function">curl_easy_strerror</span></span><span class="Delimiter">(</span><span class="-variable">res</span><span class="Delimiter">)</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
            <span class="Delimiter">}</span> <span class="Keyword">else</span> <span class="Delimiter">{</span>
                <span class="-variable"><span class="Function">curl_easy_getinfo</span></span><span class="Delimiter">(</span><span class="-variable">curl</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">CURLINFO_RESPONSE_CODE</span></span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-variable">http_code</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
                <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">http_code</span> <span class="Operator">&gt;=</span> <span class="Number">1</span> <span class="Operator">&amp;&amp;</span> <span class="-variable">http_code</span> <span class="Operator">!=</span> <span class="Number">200</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
                    <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;http error: %ld<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-variable">http_code</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
                <span class="Delimiter">}</span>
            <span class="Delimiter">}</span>
        <span class="Delimiter">}</span>

        <span class="Comment"><span class="-spell">/* ❗ CLEANUP ❗ */</span></span>
        <span class="-variable"><span class="Function">curl_easy_cleanup</span></span><span class="Delimiter">(</span><span class="-variable">curl</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Function">fclose</span></span><span class="Delimiter">(</span><span class="-variable">temp_json_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span>

    <span class="Comment"><span class="-spell">/*<span class="NonText">·</span>
     * To read json data we need to<span class="NonText">·</span>
     * open the file ✅
     * read the contents into a buffer ✅
     * parse the JSON data ✅
     * delete the json object ✅<span class="NonText">·</span>
     *
     * https://www.geeksforgeeks.org/cjson-json-file-write-read-modify-in-c/
     *
     * printing / parsing json. https://github.com/DaveGamble/cJSON?tab=readme-ov-file#printing-json
     */</span></span>


    <span class="-variable">temp_json_file</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">fopen</span></span><span class="Delimiter">(</span><span class="-variable">json_filename</span><span class="Delimiter">,</span> <span class="String">&quot;rb&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span><span class="NonText">·</span>

    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">temp_json_file</span> <span class="Operator">==</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;Error: Couldn't open file: %s<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-variable">json_filename</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Function">fclose</span></span><span class="Delimiter">(</span><span class="-variable">temp_json_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">return</span> <span class="Number">1</span><span class="Delimiter">;</span>

    <span class="Delimiter">}</span>

    <span class="Comment"><span class="-spell">// Get file size</span></span>
    <span class="Comment"><span class="-spell">// this code is from claude ai<span class="NonText">·</span></span></span>

    <span class="-variable"><span class="Function">fseek</span></span><span class="Delimiter">(</span><span class="-variable">temp_json_file</span><span class="Delimiter">,</span> <span class="Number">0</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">SEEK_END</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="PreProc">long</span> <span class="-variable">file_size</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">ftell</span></span><span class="Delimiter">(</span><span class="-variable">temp_json_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="-variable"><span class="Function">fseek</span></span><span class="Delimiter">(</span><span class="-variable">temp_json_file</span><span class="Delimiter">,</span> <span class="Number">0</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">SEEK_SET</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Comment"><span class="-spell">// ---------------</span></span>


    <span class="Comment"><span class="-spell">// get a buffer, that is as big as the file.</span></span>
    <span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">buffer</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">malloc</span></span><span class="Delimiter">(</span><span class="-variable">file_size</span> <span class="Operator">+</span> <span class="Number">1</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">buffer</span> <span class="Operator">==</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;Couldn't allocate enough memory.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Function">fclose</span></span><span class="Delimiter">(</span><span class="-variable">temp_json_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">return</span> <span class="Number">1</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span>

    <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">json</span><span class="Delimiter">;</span>

    <span class="Comment"><span class="-spell">/*<span class="NonText">·</span>
     * claude helped me make the code a bit more efficient and easier to write,<span class="NonText">·</span>
     *
     * using file_size and not size_of(file_size) here is important, so as to not the<span class="NonText">·</span>
     * size of the long file_size but the actuall file_size
     *
     * &quot; Using sizeof(file_size) might not give you what you expect. Remember,<span class="NonText">·</span>
     * file_size is likely a long type, so sizeof(file_size) would give you the<span class="NonText">·</span>
     * size of a long, not the actual file size.&quot;
     *
    */</span></span>

    <span class="Keyword">while</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">fread</span></span><span class="Delimiter">(</span><span class="-variable">buffer</span><span class="Delimiter">,</span> <span class="-variable">file_size</span> <span class="Delimiter">,</span> <span class="Number">1</span><span class="Delimiter">,</span> <span class="-variable">temp_json_file</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable">json</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_Parse</span></span><span class="Delimiter">(</span><span class="-variable">buffer</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span>

    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">json</span> <span class="Operator">==</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;cJSON json is NULL.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Function">cJSON_Delete</span></span><span class="Delimiter">(</span><span class="-variable">json</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span>

    <span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">json_string</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_Print</span></span><span class="Delimiter">(</span><span class="-variable">json</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">json_string</span> <span class="Operator">==</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;Failed to print json_string: %s.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-variable">json_string</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Function">cJSON_Delete</span></span><span class="Delimiter">(</span><span class="-variable">json</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span>

    <span class="Keyword">const</span> <span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">error_ptr</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetErrorPtr</span></span><span class="Delimiter">(</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">error_ptr</span> <span class="Operator">!=</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;Error before: %s<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-variable">error_ptr</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span>


    <span class="Comment"><span class="-spell">/* filter the usefull information and display it nicely */</span></span>

    <span class="Comment"><span class="-spell">// NOTE: Error handling is being done above</span></span>

    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">api_error</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">api_success</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">api_error_code</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">api_error_info</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>

    <span class="Comment"><span class="-spell">// const cJSON *request = NULL;</span></span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">location</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">current</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>

    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">name</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Comment"><span class="-spell">// const cJSON *unit = NULL;</span></span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">observation_time</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">temperature</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">weather_descriptions</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">wind_speed</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">humidity</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>
    <span class="Keyword">const</span> <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">feelslike</span> <span class="Operator">=</span> <span class="PreProc">NULL</span><span class="Delimiter">;</span>

    <span class="Comment"><span class="-spell">/* We can't access name directly since its nested, so we first need to<span class="NonText">·</span>
     * parse everything and then parse location<span class="NonText">·</span>
    */</span></span>


    <span class="Comment"><span class="-spell">/* This is for handling api error codes, and get a &quot;custom&quot; error message<span class="NonText">·</span>
     * bzw. nicer looking, instead of the json<span class="NonText">·</span>
    */</span></span>


    <span class="-variable">api_success</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">json</span><span class="Delimiter">,</span> <span class="String">&quot;success&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsFalse</span></span><span class="Delimiter">(</span><span class="-variable">api_success</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable">api_error</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">json</span><span class="Delimiter">,</span> <span class="String">&quot;error&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">api_error</span> <span class="Operator">!=</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="-variable">api_error_code</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">api_error</span><span class="Delimiter">,</span> <span class="String">&quot;code&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
            <span class="-variable">api_error_info</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">api_error</span><span class="Delimiter">,</span> <span class="String">&quot;info&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
            <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsNumber</span></span><span class="Delimiter">(</span><span class="-variable">api_error_code</span><span class="Delimiter">)</span> <span class="Operator">&amp;&amp;</span> <span class="Delimiter">(</span><span class="-_parent"><span class="-variable">api_error_code</span><span class="Operator">-&gt;</span><span class="NormalFg">valueint</span></span><span class="Delimiter">)</span> <span class="Operator">&amp;&amp;</span> <span class="-variable"><span class="Function">cJSON_IsString</span></span><span class="Delimiter">(</span><span class="-variable">api_error_info</span><span class="Delimiter">)</span> <span class="Operator">&amp;&amp;</span> <span class="Delimiter">(</span><span class="-_parent"><span class="-variable">api_error_info</span><span class="Operator">-&gt;</span><span class="NormalFg">valuestring</span></span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
                <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;API ERROR RESPONSE CODE: %i %s<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">api_error_code</span><span class="Operator">-&gt;</span><span class="NormalFg">valueint</span></span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">api_error_info</span><span class="Operator">-&gt;</span><span class="NormalFg">valuestring</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
            <span class="Delimiter">}</span> <span class="Keyword">else</span> <span class="Delimiter">{</span>
                <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stderr</span></span><span class="Delimiter">,</span> <span class="String">&quot;Uknown error code.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
            <span class="Delimiter">}</span>
        <span class="Delimiter">}</span>
    <span class="Delimiter">}</span>


    <span class="Comment"><span class="-spell">// FIX: How can this be more compact ? more better ?</span></span>
    <span class="Comment"><span class="-spell">// request = cJSON_GetObjectItemCaseSensitive(json, &quot;request&quot;);</span></span>

    <span class="Comment"><span class="-spell">// if (request != NULL) {</span></span>
        <span class="Comment"><span class="-spell">// unit = cJSON_GetObjectItemCaseSensitive(request, &quot;unit&quot;);</span></span>

        <span class="Comment"><span class="-spell">// if (cJSON_IsString(unit) &amp;&amp; (unit-&gt;valuestring != NULL)) {</span></span>
        <span class="Comment"><span class="-spell">//     fprintf(stdout, &quot;unit:\&quot;%s\&quot;\n&quot;, unit-&gt;valuestring);</span></span>
        <span class="Comment"><span class="-spell">// }</span></span>
    <span class="Comment"><span class="-spell">// }</span></span>

<span class="NonText">·</span><span class="NonText">·</span><span class="NonText">·</span><span class="NonText">·</span>
    <span class="-variable">current</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">json</span><span class="Delimiter">,</span> <span class="String">&quot;current&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="-variable"><span class="Function">terminal_display_picture</span></span><span class="Delimiter">(</span><span class="-variable">current</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

    <span class="-variable">location</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">json</span><span class="Delimiter">,</span> <span class="String">&quot;location&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">location</span> <span class="Operator">!=</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable">name</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">location</span><span class="Delimiter">,</span> <span class="String">&quot;name&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsString</span></span><span class="Delimiter">(</span><span class="-variable">name</span><span class="Delimiter">)</span> <span class="Operator">&amp;&amp;</span> <span class="Delimiter">(</span><span class="-_parent"><span class="-variable">name</span><span class="Operator">-&gt;</span><span class="NormalFg">valuestring</span></span> <span class="Operator">!=</span> <span class="PreProc">NULL</span> <span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="Comment"><span class="-spell">//printf(&quot;\n\033[2A&quot;);</span></span>
<span class="NonText">»   </span>    <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stdout</span></span><span class="Delimiter">,</span> <span class="String">&quot;<span class="PreProc">\033</span>[4mWeather report for:<span class="PreProc">\033</span>[0m &quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="NonText">»   </span>    <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stdout</span></span><span class="Delimiter">,</span> <span class="String">&quot;%s<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">name</span><span class="Operator">-&gt;</span><span class="NormalFg">valuestring</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Delimiter">}</span>
    <span class="Delimiter">}</span>

    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">current</span> <span class="Operator">!=</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="-variable">observation_time</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">current</span><span class="Delimiter">,</span> <span class="String">&quot;observation_time&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsString</span></span><span class="Delimiter">(</span><span class="-variable">observation_time</span><span class="Delimiter">)</span> <span class="Operator">&amp;&amp;</span> <span class="Delimiter">(</span><span class="-_parent"><span class="-variable">observation_time</span><span class="Operator">-&gt;</span><span class="NormalFg">valuestring</span></span> <span class="Operator">!=</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stdout</span></span><span class="Delimiter">,</span> <span class="String">&quot;<span class="PreProc">\n</span><span class="PreProc">\033</span>[4mObservation Time:<span class="PreProc">\033</span>[0m %s.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">observation_time</span><span class="Operator">-&gt;</span><span class="NormalFg">valuestring</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Delimiter">}</span>

        <span class="-variable">temperature</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">current</span><span class="Delimiter">,</span> <span class="String">&quot;temperature&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Comment"><span class="-spell">/* since temperature is a number we have to check for a number */</span></span>
        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsNumber</span></span><span class="Delimiter">(</span><span class="-variable">temperature</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stdout</span></span><span class="Delimiter">,</span> <span class="String">&quot;<span class="PreProc">\n</span><span class="PreProc">\033</span>[4mTemperature<span class="PreProc">\033</span>[0m: %i°C.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">temperature</span><span class="Operator">-&gt;</span><span class="NormalFg">valueint</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Delimiter">}</span>


        <span class="-variable">wind_speed</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">current</span><span class="Delimiter">,</span> <span class="String">&quot;wind_speed&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="-variable">weather_descriptions</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">current</span><span class="Delimiter">,</span> <span class="String">&quot;weather_descriptions&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Comment"><span class="-spell">/* to print the part of the array, we first need to index, since there<span class="NonText">·</span>
         * is only ever one entry in the array we can alway index to 0<span class="NonText">·</span>
        */</span></span>

        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsArray</span></span><span class="Delimiter">(</span><span class="-variable">weather_descriptions</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="Keyword">cJSON</span> <span class="Operator">*</span><span class="-variable">weather_descriptions_array_item</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetArrayItem</span></span><span class="Delimiter">(</span><span class="-variable">weather_descriptions</span><span class="Delimiter">,</span> <span class="Number">0</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
            <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsString</span></span><span class="Delimiter">(</span><span class="-variable">weather_descriptions_array_item</span><span class="Delimiter">)</span> <span class="Operator">&amp;&amp;</span> <span class="Delimiter">(</span><span class="-_parent"><span class="-variable">weather_descriptions_array_item</span><span class="Operator">-&gt;</span><span class="NormalFg">valuestring</span></span> <span class="Operator">!=</span> <span class="PreProc">NULL</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
                <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stdout</span></span><span class="Delimiter">,</span> <span class="String">&quot;<span class="PreProc">\n</span><span class="PreProc">\033</span>[4mWeather<span class="PreProc">\033</span>[0m: %s. <span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">weather_descriptions_array_item</span><span class="Operator">-&gt;</span><span class="NormalFg">valuestring</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
            <span class="Delimiter">}</span>
        <span class="Delimiter">}</span>

        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsNumber</span></span><span class="Delimiter">(</span><span class="-variable">wind_speed</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stdout</span></span><span class="Delimiter">,</span> <span class="String">&quot;<span class="PreProc">\n</span><span class="PreProc">\033</span>[4mWind speed<span class="PreProc">\033</span>[0m: %i km/h.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">wind_speed</span><span class="Operator">-&gt;</span><span class="NormalFg">valueint</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Delimiter">}</span>


        <span class="-variable">humidity</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">current</span><span class="Delimiter">,</span> <span class="String">&quot;humidity&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsNumber</span></span><span class="Delimiter">(</span><span class="-variable">humidity</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stdout</span></span><span class="Delimiter">,</span> <span class="String">&quot;<span class="PreProc">\n</span><span class="PreProc">\033</span>[4mHumidity:<span class="PreProc">\033</span>[0m %i%%.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">humidity</span><span class="Operator">-&gt;</span><span class="NormalFg">valueint</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Delimiter">}</span>

        <span class="-variable">feelslike</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">cJSON_GetObjectItemCaseSensitive</span></span><span class="Delimiter">(</span><span class="-variable">current</span><span class="Delimiter">,</span> <span class="String">&quot;feelslike&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable"><span class="Function">cJSON_IsNumber</span></span><span class="Delimiter">(</span><span class="-variable">feelslike</span><span class="Delimiter">)</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="-variable"><span class="Function">fprintf</span></span><span class="Delimiter">(</span><span class="-variable"><span class="PreProc">stdout</span></span><span class="Delimiter">,</span> <span class="String">&quot;<span class="PreProc">\n</span><span class="PreProc">\033</span>[4mFeels like<span class="PreProc">\033</span>[0m: %i°C.<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">,</span> <span class="-_parent"><span class="-variable">feelslike</span><span class="Operator">-&gt;</span><span class="NormalFg">valueint</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Delimiter">}</span>
    <span class="Delimiter">}</span>

    <span class="-variable"><span class="Function">fclose</span></span><span class="Delimiter">(</span><span class="-variable">read_api_key_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="-variable"><span class="Function">fclose</span></span><span class="Delimiter">(</span><span class="-variable">temp_json_file</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="-variable"><span class="Function">free</span></span><span class="Delimiter">(</span><span class="-variable">buffer</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="-variable"><span class="Function">free</span></span><span class="Delimiter">(</span><span class="-variable">json_string</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="-variable"><span class="Function">cJSON_Delete</span></span><span class="Delimiter">(</span><span class="-variable">json</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

    <span class="Keyword">return</span> <span class="Number">0</span><span class="Delimiter">;</span>
<span class="Delimiter">}</span>


<span class="Comment"><span class="-spell">/* https://curl.se/libcurl/c/url2file.html
 *
 *
 * The function itself is a wrapper around the standard C library function fwrite. Here's what it does:
 * It takes four parameters:
 * ptr: A pointer to the data to be written
 * size: The size of each element to be written
 * nmemb: The number of elements to write
 * stream: A pointer to the FILE stream where data will be written

 * It calls fwrite with these parameters, casting stream to a FILE* pointer.
 * It returns the number of elements successfully written.
 *
*/</span></span>


<span class="PreProc">size_t</span> <span class="-variable"><span class="Function">write_data</span></span><span class="Delimiter">(</span><span class="PreProc">void</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">ptr</span></span><span class="Delimiter">,</span> <span class="PreProc">size_t</span> <span class="-variable"><span class="-variable">size</span></span><span class="Delimiter">,</span> <span class="PreProc">size_t</span> <span class="-variable"><span class="-variable">nmemb</span></span><span class="Delimiter">,</span> <span class="PreProc">void</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">stream</span></span><span class="Delimiter">)</span>
<span class="Delimiter">{</span>
    <span class="Comment"><span class="-spell">/* (FILE *) stream  is a so called cast operation. In this case the cast basically says
     *
     * &quot;I know this void * pointer is actually pointing to a FILE structure, so it's safe to treat it as a FILE * &quot;
     *
     * NOTE: I got help from claude, explaining this function. I obviously,<span class="NonText">·</span>
     * took it from the libcurl website but I understand it thanks to claude explaining it.
    */</span></span>
    <span class="PreProc">size_t</span> <span class="-variable">written</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">fwrite</span></span><span class="Delimiter">(</span><span class="-variable">ptr</span><span class="Delimiter">,</span> <span class="-variable">size</span><span class="Delimiter">,</span> <span class="-variable">nmemb</span><span class="Delimiter">,</span> <span class="Delimiter">(</span><span class="Keyword"><span class="Keyword">FILE</span> <span class="Operator">*</span></span><span class="Delimiter">)</span> <span class="-variable">stream</span><span class="Delimiter">)</span><span class="Delimiter">;</span>

    <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="-variable">written</span> <span class="Operator">!=</span> <span class="-variable">nmemb</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="Comment"><span class="-spell">// fprintf(stderr, &quot;fwrite() failed: %s\n&quot;, strerror(errno));</span></span>
        <span class="-variable"><span class="Function">perror</span></span><span class="Delimiter">(</span><span class="String">&quot;fwrite() failed&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="Delimiter">}</span>
    <span class="Keyword">return</span> <span class="-variable">written</span><span class="Delimiter">;</span>
<span class="Delimiter">}</span>

<span class="Comment"><span class="-spell">/* We are putting together the url, with the base url the secret api key, and the user input city */</span></span>
<span class="PreProc">void</span> <span class="-variable"><span class="Function">build_url</span></span><span class="Delimiter">(</span><span class="PreProc">char</span> <span class="-variable"><span class="Operator">*</span><span class="-variable"><span class="Constant">CITY</span></span></span><span class="Delimiter">)</span><span class="NonText">·</span>
<span class="Delimiter">{</span>
    <span class="Comment"><span class="-spell">// NOTE: there is also the possibility to do query = fetch:ip, to pass the<span class="NonText">·</span></span></span>
    <span class="Comment"><span class="-spell">// ip to the api, to get the weather for your location</span></span>
    <span class="-variable"><span class="Function">snprintf</span></span><span class="Delimiter">(</span><span class="-variable">url</span><span class="Delimiter">,</span> <span class="Keyword">sizeof</span><span class="Delimiter">(</span><span class="-variable">url</span><span class="Delimiter">)</span><span class="Delimiter">,</span> <span class="String">&quot;%s?access_key=%s&amp;query=%s&quot;</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">BASE_URL</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">ACCESS_KEY</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">CITY</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>
<span class="Delimiter">}</span>

<span class="Comment"><span class="-spell">// --------------------------------------------------------------------</span></span>
<span class="Comment"><span class="-spell">// --------------------------------------------------------------------</span></span>

<span class="Keyword">enum</span> <span class="Keyword">umlaute</span> <span class="Delimiter">{</span>
    <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_A</span></span></span> <span class="Operator">=</span> <span class="Number">196</span><span class="Delimiter">,</span>
    <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_O</span></span></span> <span class="Operator">=</span> <span class="Number">214</span><span class="Delimiter">,</span>
    <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_U</span></span></span> <span class="Operator">=</span> <span class="Number">220</span><span class="Delimiter">,</span>
    <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_A</span></span></span> <span class="Operator">=</span> <span class="Number">228</span><span class="Delimiter">,</span>
    <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_O</span></span></span> <span class="Operator">=</span> <span class="Number">246</span><span class="Delimiter">,</span><span class="NonText">·</span>
    <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_U</span></span></span> <span class="Operator">=</span> <span class="Number">252</span><span class="Delimiter">,</span>
<span class="Delimiter">}</span><span class="Delimiter">;</span>

<span class="Comment"><span class="-spell">/*  This function filters the characters it is given and determines if the wchar_t given
 *  is a umlaut or not, if the input character is a umlaut it replaces it with the &quot;normal&quot; letters<span class="NonText">·</span>
*/</span></span>
<span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable"><span class="Function">filter_char</span></span><span class="Delimiter">(</span><span class="Keyword">const</span> <span class="Keyword">wchar_t</span> <span class="-variable"><span class="-variable">input</span></span><span class="Delimiter">,</span> <span class="PreProc">size_t</span> <span class="-variable"><span class="-variable">output_size</span></span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
    <span class="Comment"><span class="-spell">// output size sizeof(wchar_t)</span></span>

    <span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">output</span> <span class="Operator">=</span> <span class="String">&quot;zero&quot;</span><span class="Delimiter">;</span>

    <span class="PreProc">size_t</span> <span class="-variable">j</span> <span class="Operator">=</span> <span class="Number">0</span><span class="Delimiter">;</span>
    <span class="Comment"><span class="-spell">// if input[i] UMLAUT A O U then replace else nothing</span></span>

    <span class="Keyword">switch</span><span class="Delimiter">(</span><span class="-variable">input</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_A</span></span></span> <span class="Delimiter">:</span> <span class="-variable"><span class="Function">replace_umlaute</span></span><span class="Delimiter">(</span><span class="-variable">output</span><span class="Delimiter">,</span> <span class="-variable">input</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-variable">j</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_O</span></span></span> <span class="Delimiter">:</span> <span class="-variable"><span class="Function">replace_umlaute</span></span><span class="Delimiter">(</span><span class="-variable">output</span><span class="Delimiter">,</span> <span class="-variable">input</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-variable">j</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_U</span></span></span> <span class="Delimiter">:</span> <span class="-variable"><span class="Function">replace_umlaute</span></span><span class="Delimiter">(</span><span class="-variable">output</span><span class="Delimiter">,</span> <span class="-variable">input</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-variable">j</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_A</span></span></span> <span class="Delimiter">:</span> <span class="-variable"><span class="Function">replace_umlaute</span></span><span class="Delimiter">(</span><span class="-variable">output</span><span class="Delimiter">,</span> <span class="-variable">input</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-variable">j</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_O</span></span></span> <span class="Delimiter">:</span> <span class="-variable"><span class="Function">replace_umlaute</span></span><span class="Delimiter">(</span><span class="-variable">output</span><span class="Delimiter">,</span> <span class="-variable">input</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-variable">j</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_U</span></span></span> <span class="Delimiter">:</span> <span class="-variable"><span class="Function">replace_umlaute</span></span><span class="Delimiter">(</span><span class="-variable">output</span><span class="Delimiter">,</span> <span class="-variable">input</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-variable">j</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
        <span class="Keyword">default</span> <span class="Delimiter">:</span> <span class="Keyword">break</span> <span class="Delimiter">;</span>
    <span class="Delimiter">}</span>
    <span class="Keyword">return</span> <span class="-variable">output</span><span class="Delimiter">;</span>
<span class="Delimiter">}</span>


<span class="Comment"><span class="-spell">/* This function takes in the destination string and the char for ü ä ö, the size_t *j is there<span class="NonText">·</span>
 * to keep track  of the current possition in the whole destination string
*/</span></span>
<span class="PreProc">void</span> <span class="-variable"><span class="Function">replace_umlaute</span></span><span class="Delimiter">(</span><span class="PreProc">char</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">dest</span></span><span class="Delimiter">,</span> <span class="Keyword">wchar_t</span> <span class="-variable"><span class="-variable">umlaut</span></span><span class="Delimiter">,</span> <span class="PreProc">size_t</span> <span class="-variable"><span class="Operator">*</span><span class="-variable">j</span></span><span class="Delimiter">)</span> <span class="Delimiter">{</span>

    <span class="Comment"><span class="-spell">// NOTE: wchar_t umlaut has to be a char and cant be a string because the<span class="NonText">·</span></span></span>
    <span class="Comment"><span class="-spell">// switch case statement doenst take a string</span></span>
    <span class="Keyword">const</span> <span class="PreProc">char</span> <span class="Operator">*</span><span class="-variable">replacement</span><span class="Delimiter">;</span>

    <span class="Keyword">switch</span><span class="Delimiter">(</span><span class="-variable">umlaut</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_A</span></span></span><span class="Delimiter">:</span> <span class="-variable">replacement</span> <span class="Operator">=</span> <span class="String">&quot;AE&quot;</span><span class="Delimiter">;</span> <span class="Keyword">break</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_O</span></span></span><span class="Delimiter">:</span> <span class="-variable">replacement</span> <span class="Operator">=</span> <span class="String">&quot;OE&quot;</span><span class="Delimiter">;</span> <span class="Keyword">break</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_BIG_U</span></span></span><span class="Delimiter">:</span> <span class="-variable">replacement</span> <span class="Operator">=</span> <span class="String">&quot;UE&quot;</span><span class="Delimiter">;</span> <span class="Keyword">break</span><span class="Delimiter">;</span>

        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_A</span></span></span><span class="Delimiter">:</span> <span class="-variable">replacement</span> <span class="Operator">=</span> <span class="String">&quot;ae&quot;</span><span class="Delimiter">;</span> <span class="Keyword">break</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_O</span></span></span><span class="Delimiter">:</span> <span class="-variable">replacement</span> <span class="Operator">=</span> <span class="String">&quot;oe&quot;</span><span class="Delimiter">;</span> <span class="Keyword">break</span><span class="Delimiter">;</span>
        <span class="Keyword">case</span> <span class="-variable"><span class="Constant"><span class="Constant">UMLAUT_SMALL_U</span></span></span><span class="Delimiter">:</span> <span class="-variable">replacement</span> <span class="Operator">=</span> <span class="String">&quot;ue&quot;</span><span class="Delimiter">;</span> <span class="Keyword">break</span><span class="Delimiter">;</span>


        <span class="Keyword">default</span> <span class="Delimiter">:</span> <span class="Keyword">break</span><span class="Delimiter">;</span><span class="NonText">·</span>
    <span class="Delimiter">}</span>

    <span class="-variable"><span class="Function">printf</span></span><span class="Delimiter">(</span><span class="String">&quot;-------------------<span class="PreProc">\n</span>&quot;</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="-variable"><span class="Function">printf</span></span><span class="Delimiter">(</span><span class="String">&quot;UMLAUT_BIG_A: %i&quot;</span><span class="Delimiter">,</span> <span class="-variable"><span class="Constant">UMLAUT_BIG_A</span></span><span class="Delimiter">)</span><span class="Delimiter">;</span>


    <span class="Comment"><span class="-spell">/* Die Klammern sind wichtig denn ohne die Klammern würden wir den<span class="NonText">·</span>
     * Pointer erhöhen und nicht das value jetzt dereferencen wir und<span class="NonText">·</span>
     * erhöhen dann das value
    */</span></span>

    <span class="-variable">dest</span><span class="Delimiter">[</span><span class="Delimiter">(</span><span class="Operator">*</span><span class="-variable">j</span><span class="Delimiter">)</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="-variable">replacement</span><span class="Delimiter">[</span><span class="Number">0</span><span class="Delimiter">]</span><span class="Delimiter">;</span>
    <span class="-variable">dest</span><span class="Delimiter">[</span><span class="Delimiter">(</span><span class="Operator">*</span><span class="-variable">j</span><span class="Delimiter">)</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="-variable">replacement</span><span class="Delimiter">[</span><span class="Number">1</span><span class="Delimiter">]</span><span class="Delimiter">;</span>
<span class="Delimiter">}</span>


<span class="Comment"><span class="-spell">// --------------------------------------------------------------------</span></span>
<span class="Comment"><span class="-spell">// --------------------------------------------------------------------</span></span>


<span class="Comment"><span class="-spell">/*  NOTE: the transliterate_umlaut function is from claude.ai
*   above is my attempt I tried for days but got nowhere. I dont think I wouldve figured
*   this out I was on the wrong path
*/</span></span>
<span class="PreProc">char</span><span class="Operator">*</span> <span class="-variable"><span class="Function">transliterate_umlaut</span></span><span class="Delimiter">(</span><span class="Keyword">const</span> <span class="PreProc">char</span><span class="-variable"><span class="Operator">*</span> <span class="-variable">input</span></span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
    <span class="PreProc">size_t</span> <span class="-variable">len</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">strlen</span></span><span class="Delimiter">(</span><span class="-variable">input</span><span class="Delimiter">)</span><span class="Delimiter">;</span>
    <span class="PreProc">char</span><span class="Operator">*</span> <span class="-variable">output</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">malloc</span></span><span class="Delimiter">(</span><span class="-variable">len</span> <span class="Operator">*</span> <span class="Number">2</span> <span class="Operator">+</span> <span class="Number">1</span><span class="Delimiter">)</span><span class="Delimiter">;</span> <span class="Comment"><span class="-spell">// Worst case: every char is an umlaut</span></span>
    <span class="PreProc">size_t</span> <span class="-variable">j</span> <span class="Operator">=</span> <span class="Number">0</span><span class="Delimiter">;</span>

    <span class="Keyword">for</span> <span class="Delimiter">(</span><span class="PreProc">size_t</span> <span class="-variable">i</span> <span class="Operator">=</span> <span class="Number">0</span><span class="Delimiter">;</span> <span class="-variable">i</span> <span class="Operator">&lt;</span> <span class="-variable">len</span><span class="Delimiter">;</span> <span class="Delimiter">)</span> <span class="Delimiter">{</span>
        <span class="Keyword">if</span> <span class="Delimiter">(</span><span class="Delimiter">(</span><span class="Keyword"><span class="PreProc">unsigned</span> <span class="PreProc"><span class="PreProc">char</span></span></span><span class="Delimiter">)</span><span class="-variable">input</span><span class="Delimiter">[</span><span class="-variable">i</span><span class="Delimiter">]</span> <span class="Operator">==</span> <span class="Number">0xC3</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
            <span class="Keyword">switch</span> <span class="Delimiter">(</span><span class="Delimiter">(</span><span class="Keyword"><span class="PreProc">unsigned</span> <span class="PreProc"><span class="PreProc">char</span></span></span><span class="Delimiter">)</span><span class="-variable">input</span><span class="Delimiter">[</span><span class="-variable">i</span> <span class="Operator">+</span> <span class="Number">1</span><span class="Delimiter">]</span><span class="Delimiter">)</span> <span class="Delimiter">{</span>
                <span class="Keyword">case</span> <span class="Number">0xA4</span><span class="Delimiter">:</span> <span class="Comment"><span class="-spell">// ä</span></span>
                <span class="Keyword">case</span> <span class="Number">0x84</span><span class="Delimiter">:</span> <span class="Comment"><span class="-spell">// Ä</span></span>
                    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="String">'a'</span><span class="Delimiter">;</span>
                    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="String">'e'</span><span class="Delimiter">;</span>
                    <span class="Keyword">break</span><span class="Delimiter">;</span>
                <span class="Keyword">case</span> <span class="Number">0xB6</span><span class="Delimiter">:</span> <span class="Comment"><span class="-spell">// ö</span></span>
                <span class="Keyword">case</span> <span class="Number">0x96</span><span class="Delimiter">:</span> <span class="Comment"><span class="-spell">// Ö</span></span>
                    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="String">'o'</span><span class="Delimiter">;</span>
                    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="String">'e'</span><span class="Delimiter">;</span>
                    <span class="Keyword">break</span><span class="Delimiter">;</span>
                <span class="Keyword">case</span> <span class="Number">0xBC</span><span class="Delimiter">:</span> <span class="Comment"><span class="-spell">// ü</span></span>
                <span class="Keyword">case</span> <span class="Number">0x9C</span><span class="Delimiter">:</span> <span class="Comment"><span class="-spell">// Ü</span></span>
                    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="String">'u'</span><span class="Delimiter">;</span>
                    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="String">'e'</span><span class="Delimiter">;</span>
                    <span class="Keyword">break</span><span class="Delimiter">;</span>
                <span class="Keyword">default</span><span class="Delimiter">:</span>
                    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="-variable">input</span><span class="Delimiter">[</span><span class="-variable">i</span><span class="Delimiter">]</span><span class="Delimiter">;</span>
                    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="-variable">input</span><span class="Delimiter">[</span><span class="-variable">i</span> <span class="Operator">+</span> <span class="Number">1</span><span class="Delimiter">]</span><span class="Delimiter">;</span>
            <span class="Delimiter">}</span>
            <span class="-variable">i</span> <span class="Operator">+=</span> <span class="Number">2</span><span class="Delimiter">;</span>
        <span class="Delimiter">}</span> <span class="Keyword">else</span> <span class="Delimiter">{</span>
            <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Operator">++</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="-variable">input</span><span class="Delimiter">[</span><span class="-variable">i</span><span class="Operator">++</span><span class="Delimiter">]</span><span class="Delimiter">;</span>
        <span class="Delimiter">}</span>
    <span class="Delimiter">}</span>
    <span class="-variable">output</span><span class="Delimiter">[</span><span class="-variable">j</span><span class="Delimiter">]</span> <span class="Operator">=</span> <span class="String">'<span class="PreProc">\0</span>'</span><span class="Delimiter">;</span>
    <span class="Keyword">return</span> <span class="-variable">output</span><span class="Delimiter">;</span>
<span class="Delimiter">}</span>

</pre>
</body>
</html>
